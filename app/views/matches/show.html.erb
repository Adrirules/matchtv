<% if @match.present? %>
  <%# ---- 1. Logique de Date (Calculs) ---- %>
  <%
    date_label =
      if @match.start_time.to_date == Date.today
        "aujourd‚Äôhui"
      elsif @match.start_time.to_date == Date.today + 1.day
        "demain"
      else
        l(@match.start_time.to_date, format: "%d %B %Y")
      end
  %>

  <%# ---- 2. SEO : Envoi des donn√©es au Layout ---- %>
  <% content_for :title, "üì∫ #{@match.home_team} - #{@match.away_team} : Sur quelle cha√Æne voir le match ?" %>
  <% content_for :meta_description, "Match #{@match.home_team} - #{@match.away_team} diffus√© #{date_label} √† #{@match.start_time.strftime("%H:%M")} en direct sur #{@match.tv_channels}. Retrouvez le guide TV complet et streaming." %>

  <%# ---- 3. Navigation ---- %>
  <nav style="margin: 15px 0;">
    <p style="font-size: 13px; color: #777;">
      <%= link_to "‚Üê Programme TV foot #{date_label}", day_path(@match.start_time.to_date), style: "color: #777; text-decoration: none;" %>
    </p>
  </nav>

  <%# ---- 4. Le Bloc Match "Premium" ---- %>
  <div class="match-detail-wrapper" style="background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); padding: 35px 15px; text-align: center; margin-bottom: 25px; border: 1px solid #f0f0f0;">

    <div style="margin-bottom: 30px;">
      <h1 style="font-size: 15px; font-weight: 800; text-transform: uppercase; color: #010e1b; letter-spacing: 1px; margin: 0;">
        <%= @match.competition %>
      </h1>
      <span style="font-size: 12px; color: #999; font-weight: 500;">Saison 2025/2026</span>
    </div>

    <div style="display: flex; justify-content: space-around; align-items: center; max-width: 600px; margin: 0 auto 40px;">

      <%# Equipe Domicile %>
      <div style="flex: 1; text-align: center;">
        <div style="width: 80px; height: 80px; margin: 0 auto 12px; display: flex; align-items: center; justify-content: center;">
          <img src="<%= @match.home_team_logo %>" alt="Logo <%= @match.home_team %>" style="max-width: 100%; max-height: 100%; object-fit: contain;">
        </div>
        <div style="font-weight: 800; font-size: 18px; color: #010e1b; line-height: 1.2;"><%= @match.home_team %></div>
      </div>

      <%# Heure du Match %>
      <div style="flex: 0.8; text-align: center; padding: 0 10px;">
        <div style="font-size: 13px; color: #d9534f; font-weight: 700; margin-bottom: 5px; text-transform: uppercase;">Direct</div>
        <div style="font-size: 42px; font-weight: 900; color: #222; line-height: 1;">
          <%= @match.start_time.strftime("%Hh%M") %>
        </div>
        <div style="font-size: 12px; color: #666; margin-top: 8px; font-weight: 600;"><%= l(@match.start_time, format: "%d/%m") %></div>
      </div>

      <%# Equipe Ext√©rieur %>
      <div style="flex: 1; text-align: center;">
        <div style="width: 80px; height: 80px; margin: 0 auto 12px; display: flex; align-items: center; justify-content: center;">
          <img src="<%= @match.away_team_logo %>" alt="Logo <%= @match.away_team %>" style="max-width: 100%; max-height: 100%; object-fit: contain;">
        </div>
        <div style="font-weight: 800; font-size: 18px; color: #010e1b; line-height: 1.2;"><%= @match.away_team %></div>
      </div>
    </div>

    <%# Badge Diffuseur avec Stylisation Dynamique %>
    <div style="background: #f8f9fa; border-radius: 12px; padding: 15px 25px; display: inline-flex; align-items: center; border: 1px solid #eee;">
      <span style="font-size: 20px; margin-right: 12px;">üì∫</span>
      <div style="text-align: left;">
        <div style="font-size: 11px; color: #777; font-weight: 600; text-transform: uppercase;">Diffuseur Officiel</div>
        <strong style="font-size: 19px; font-weight: 900;">
          <% if @match.tv_channels.to_s.include?("DAZN") %>
            <span style="color: #000;">DAZN</span>
          <% elsif @match.tv_channels.to_s.include?("Canal") %>
            <span style="color: #ed1c24;">CANAL+</span>
          <% elsif @match.tv_channels.to_s.include?("beIN") %>
            <span style="color: #004a99;">beIN SPORTS</span>
          <% else %>
            <span style="color: #d9534f;"><%= @match.tv_channels %></span>
          <% end %>
        </strong>
      </div>
    </div>
  </div>

  <%# ---- 5. Zone Pub / SEO Textuel ---- %>
  <div style="margin: 20px 0; padding: 15px; background: #fffbe6; border: 1px dashed #ffcc00; border-radius: 8px; text-align: center; font-size: 11px; color: #856404;">
    ESPACE PUBLICITAIRE
  </div>

  <section style="margin: 40px 0; background: #fff; padding: 25px; border-radius: 12px; line-height: 1.7; box-shadow: 0 2px 10px rgba(0,0,0,0.02);">
    <h2 style="font-size: 22px; font-weight: 800; color: #010e1b; margin-bottom: 15px;">D√©tails de la diffusion TV</h2>
    <p style="font-size: 16px; color: #333; margin-bottom: 15px;">
      Le match <strong><%= @match.home_team %></strong> recevra <strong><%= @match.away_team %></strong> √† l'occasion de la <strong><%= @match.competition %></strong>.
      La rencontre sera retransmise en direct ce <strong><%= date_label %></strong> √† <strong><%= @match.start_time.strftime("%Hh%M") %></strong> sur la cha√Æne <strong><%= @match.tv_channels %></strong>.
    </p>
    <p style="font-size: 16px; color: #333;">
      Pour suivre le match en streaming l√©gal sur votre ordinateur, tablette ou smartphone, il vous faudra passer par l'application officielle du diffuseur (Canal+ Foot, beIN CONNECT, DAZN, etc.) muni de votre abonnement.
    </p>
  </section>

  <%# ---- 6. Donn√©es Structur√©es JSON-LD ---- %>
  <script type="application/ld+json">
    <%= {
      "@context": "https://schema.org",
      "@type": "SportsEvent",
      "name": "#{@match.home_team} vs #{@match.away_team}",
      "description": "Retrouvez sur quelle cha√Æne voir le match #{@match.home_team} vs #{@match.away_team} en direct pour la #{@match.competition}. Guide TV complet et streaming.",
      "startDate": @match.start_time.iso8601,
      "endDate": (@match.start_time + 110.minutes).iso8601, # On estime la fin du match
      "eventStatus": "https://schema.org/ScheduledScheduled",
      "image": [@match.home_team_logo, @match.away_team_logo],
      "sport": "Football",
      "homeTeam": {
        "@type": "SportsTeam",
        "name": @match.home_team,
        "logo": @match.home_team_logo,
        "url": "https://www.coupdenvoi.tv/equipes/#{@match.home_team.parameterize}"
      },
      "awayTeam": {
        "@type": "SportsTeam",
        "name": @match.away_team,
        "logo": @match.away_team_logo,
        "url": "https://www.coupdenvoi.tv/equipes/#{@match.away_team.parameterize}"
      },
      "location": {
        "@type": "Place",
        "name": "Stade √† confirmer", # Tu pourras affiner si tu ajoutes le venue dans ta DB
        "address": { "@type": "PostalAddress", "addressCountry": "FR" }
      },
      "offers": {
        "@type": "Offer",
        "url": "https://www.coupdenvoi.tv#{request.fullpath}",
        "availability": "https://schema.org/InStock",
        "price": "0",
        "priceCurrency": "EUR"
      },
      "performer": {
        "@type": "SportsTeam",
        "name": "#{@match.home_team} et #{@match.away_team}"
      },
      "organizer": {
        "@type": "SportsOrganization",
        "name": @match.competition,
        "url": "https://www.coupdenvoi.tv/competitions/#{@match.competition.parameterize}"
      },
      "broadcastOfEvent": {
        "@type": "BroadcastEvent",
        "isLiveBroadcast": true,
        "broadcastService": {
          "@type": "BroadcastService",
          "name": @match.tv_channels,
          "url": "https://www.coupdenvoi.tv"
        }
      }
    }.to_json.html_safe %>
  </script>
<% else %>
  <div style="text-align: center; padding: 60px 20px;">
    <h1 style="font-size: 20px; font-weight: 700;">Match non trouv√©</h1>
    <p style="color: #666; margin: 15px 0 25px;">D√©sol√©, nous n'avons aucune information de diffusion pour cette affiche actuellement.</p>
    <%= link_to "Retour au programme TV", root_path, style: "background: #007bff; color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: 600;" %>
  </div>
<% end %>
