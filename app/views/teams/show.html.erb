<% content_for :title, @page_title %>
<% content_for :meta_description, @page_desc %>

<%# Fil d'Ariane pour le SEO (Breadcrumbs) %>
<nav style="padding: 10px 15px; font-size: 12px; color: #999;">
  <%= link_to "Accueil", root_path, style: "color: #999; text-decoration: none;" %> ›
  <%= @team_name %>
  </nav>

<div style="text-align: center; padding: 30px 15px; background: white; border-bottom: 1px solid #eee; margin-bottom: 20px;">
  <% if @team_logo.present? %>
    <img src="<%= @team_logo %>" alt="Logo officiel <%= @team_name %>" style="height: 80px; width: 80px; object-fit: contain; margin-bottom: 10px;">
  <% end %>
  <h1 style="font-size: 24px; font-weight: 800; margin: 0;">Programme TV <%= @team_name %></h1>
    <p style="color: #666; font-size: 14px;">Guide TV & Prochaines diffusions</p>
</div>

<div style="padding: 0 10px;">
  <% if @matches.any? %>
    <% @matches.each do |match| %>
      <div style="margin-bottom: 15px;">

        <%# 1. Lien vers la compétition (sécurisé avec parameterize) %>
        <div style="margin-bottom: 5px; padding-left: 5px;">
          <% if match.competition.present? %>
            <%= link_to competition_path(match.competition.parameterize), style: "text-decoration: none; font-size: 11px; font-weight: 700; color: #999; text-transform: uppercase;" do %>
              <%= match.competition %>
            <% end %>
          <% end %>
        </div>

        <%# 2. Bloc Match cliquable (on utilise le slug s'il existe, sinon l'ID pour éviter l'erreur) %>
        <% match_identifier = match.slug.present? ? match.slug : match.id %>

        <%= link_to match_path(match_identifier), style: "text-decoration: none; color: inherit; display: block;" do %>
          <div style="background: white; border: 1px solid #f0f0f0; border-radius: 12px; padding: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.03);">

            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
              <span style="font-weight: 800; font-size: 13px; color: #222;">
                <%= l(match.start_time, format: "%d/%m — %H:%M") %>
              </span>
              <span style="font-size: 12px; color: #d9534f; font-weight: 700;">
                <%= match.tv_channels %>
              </span>
            </div>

            <div style="display: flex; align-items: center; justify-content: space-between;">
               <%# Equipe Domicile %>
               <div style="flex: 1; display: flex; align-items: center;">
                 <img src="<%= match.home_team_logo %>" style="width: 20px; height: 20px; margin-right: 8px; object-fit: contain;" alt="">
                 <span style="font-size: 15px; font-weight: 600; <%= 'color: #007bff;' if match.home_team.parameterize == params[:team_slug] %>">
                   <%= match.home_team %>
                 </span>
               </div>

               <span style="padding: 0 10px; color: #ccc; font-size: 11px;">VS</span>

               <%# Equipe Extérieur %>
               <div style="flex: 1; display: flex; align-items: center; justify-content: flex-end;">
                 <span style="font-size: 15px; font-weight: 600; text-align: right; <%= 'color: #007bff;' if match.away_team.parameterize == params[:team_slug] %>">
                   <%= match.away_team %>
                 </span>
                 <img src="<%= match.away_team_logo %>" style="width: 20px; height: 20px; margin-left: 8px; object-fit: contain;" alt="">
               </div>
            </div>

          </div>
        <% end %>
      </div>
    <% end %>
  <% else %>
    <p style="text-align: center; color: #666; padding: 40px 0;">Aucun match prévu pour <%= @team_name %> prochainement.</p>
  <% end %>
</div>

<%# AJOUT : JSON-LD spécifique équipe %>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SportsTeam",
  "name": "<%= @team_name %>",
  "sport": "Football",
  "logo": "<%= @team_logo %>",
  "url": "<%= request.original_url %>"
}
</script>
